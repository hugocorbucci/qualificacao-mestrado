var ToolMan={events:function(){if(!ToolMan._eventsFactory){throw"ToolMan Events module isn't loaded";}return ToolMan._eventsFactory},css:function(){if(!ToolMan._cssFactory){throw"ToolMan CSS module isn't loaded";}return ToolMan._cssFactory},coordinates:function(){if(!ToolMan._coordinatesFactory){throw"ToolMan Coordinates module isn't loaded";}return ToolMan._coordinatesFactory},drag:function(){if(!ToolMan._dragFactory){throw"ToolMan Drag module isn't loaded";}return ToolMan._dragFactory},dragsort:function(){if(!ToolMan._dragsortFactory){throw"ToolMan DragSort module isn't loaded";}return ToolMan._dragsortFactory},helpers:function(){return ToolMan._helpers}};ToolMan._helpers={map:function(a,b){for(var i=0,n=a.length;i<n;i++)b(a[i])},nextItem:function(a,b){if(a==null)return;var c=a.nextSibling;while(c!=null){if(c.nodeName==b)return c;c=c.nextSibling}return null},previousItem:function(a,b){var c=a.previousSibling;while(c!=null){if(c.nodeName==b)return c;c=c.previousSibling}return null},moveBefore:function(a,b){var c=a.parentNode;c.removeChild(a);c.insertBefore(a,b)},moveAfter:function(a,b){var c=a.parentNode;c.removeChild(a);c.insertBefore(a,b?b.nextSibling:null)}};ToolMan._eventsFactory={fix:function(a){if(!a)a=window.event;if(a.target){if(a.target.nodeType==3)a.target=a.target.parentNode}else if(a.srcElement){a.target=a.srcElement}return a},register:function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else if(a.attachEvent){if(!a._listeners)a._listeners=new Array();if(!a._listeners[b])a._listeners[b]=new Array();var d=function(){c.apply(a,new Array())};a._listeners[b][c]=d;a.attachEvent('on'+b,d)}},unregister:function(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}else if(a.detachEvent){if(a._listeners&&a._listeners[b]&&a._listeners[b][c]){a.detachEvent('on'+b,a._listeners[b][c])}}}};ToolMan._cssFactory={readStyle:function(a,b){if(a.style[b]){return a.style[b]}else if(a.currentStyle){return a.currentStyle[b]}else if(document.defaultView&&document.defaultView.getComputedStyle){var c=document.defaultView.getComputedStyle(a,null);return c.getPropertyValue(b)}else{return null}}};ToolMan._coordinatesFactory={create:function(x,y){return new _ToolManCoordinate(this,x,y)},origin:function(){return this.create(0,0)},topLeftPosition:function(a){var b=parseInt(ToolMan.css().readStyle(a,"left"));var b=isNaN(b)?0:b;var c=parseInt(ToolMan.css().readStyle(a,"top"));var c=isNaN(c)?0:c;return this.create(b,c)},bottomRightPosition:function(a){return this.topLeftPosition(a).plus(this._size(a))},topLeftOffset:function(a){var b=this._offset(a);var c=a.offsetParent;while(c){b=b.plus(this._offset(c));c=c.offsetParent}return b},bottomRightOffset:function(a){return this.topLeftOffset(a).plus(this.create(a.offsetWidth,a.offsetHeight))},scrollOffset:function(){if(window.pageXOffset){return this.create(window.pageXOffset,window.pageYOffset)}else if(document.documentElement){return this.create(document.body.scrollLeft+document.documentElement.scrollLeft,document.body.scrollTop+document.documentElement.scrollTop)}else if(document.body.scrollLeft>=0){return this.create(document.body.scrollLeft,document.body.scrollTop)}else{return this.create(0,0)}},clientSize:function(){if(window.innerHeight>=0){return this.create(window.innerWidth,window.innerHeight)}else if(document.documentElement){return this.create(document.documentElement.clientWidth,document.documentElement.clientHeight)}else if(document.body.clientHeight>=0){return this.create(document.body.clientWidth,document.body.clientHeight)}else{return this.create(0,0)}},mousePosition:function(a){a=ToolMan.events().fix(a);return this.create(a.clientX,a.clientY)},mouseOffset:function(a){a=ToolMan.events().fix(a);if(a.pageX>=0||a.pageX<0){return this.create(a.pageX,a.pageY)}else if(a.clientX>=0||a.clientX<0){return this.mousePosition(a).plus(this.scrollOffset())}},_size:function(a){return this.create(a.offsetWidth,a.offsetHeight)},_offset:function(a){return this.create(a.offsetLeft,a.offsetTop)}};function _ToolManCoordinate(a,x,y){this.factory=a;this.x=isNaN(x)?0:x;this.y=isNaN(y)?0:y};_ToolManCoordinate.prototype={toString:function(){return"("+this.x+","+this.y+")"},plus:function(a){return this.factory.create(this.x+a.x,this.y+a.y)},minus:function(a){return this.factory.create(this.x-a.x,this.y-a.y)},min:function(a){return this.factory.create(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return this.factory.create(Math.max(this.x,a.x),Math.max(this.y,a.y))},constrainTo:function(a,b){var c=a.min(b);var d=a.max(b);return this.max(c).min(d)},distance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},reposition:function(a){a.style["top"]=this.y+"px";a.style["left"]=this.x+"px"}};ToolMan._dragFactory={createSimpleGroup:function(a,b){b=b?b:a;var c=this.createGroup(a);c.setHandle(b);c.transparentDrag();c.onTopWhileDragging();return c},createGroup:function(a){var b=new _ToolManDragGroup(this,a);var c=ToolMan.css().readStyle(a,'position');if(c=='static'){a.style["position"]='relative'}else if(c=='absolute'){ToolMan.coordinates().topLeftOffset(a).reposition(a)}b.register('draginit',this._showDragEventStatus);b.register('dragmove',this._showDragEventStatus);b.register('dragend',this._showDragEventStatus);return b},_showDragEventStatus:function(a){window.status=a.toString()},constraints:function(){return this._constraintFactory},_createEvent:function(a,b,c){return new _ToolManDragEvent(a,b,c)}};function _ToolManDragGroup(a,b){this.factory=a;this.element=b;this._handle=null;this._thresholdDistance=0;this._transforms=new Array();this._listeners=new Array();this._listeners['draginit']=new Array();this._listeners['dragstart']=new Array();this._listeners['dragmove']=new Array();this._listeners['dragend']=new Array()};_ToolManDragGroup.prototype={setHandle:function(a){var b=ToolMan.events();a.toolManDragGroup=this;b.register(a,'mousedown',this._dragInit);a.onmousedown=function(){return false};if(this.element!=a)b.unregister(this.element,'mousedown',this._dragInit)},register:function(a,b){this._listeners[a].push(b)},addTransform:function(a){this._transforms.push(a)},verticalOnly:function(){this.addTransform(this.factory.constraints().vertical())},horizontalOnly:function(){this.addTransform(this.factory.constraints().horizontal())},setThreshold:function(a){this._thresholdDistance=a},transparentDrag:function(c){var c=typeof(c)!="undefined"?c:0.75;var d=ToolMan.css().readStyle(this.element,"opacity");this.register('dragstart',function(a){var b=a.group.element;b.style.opacity=c;b.style.filter='alpha(opacity='+(c*100)+')'});this.register('dragend',function(a){var b=a.group.element;b.style.opacity=d;b.style.filter='alpha(opacity=100)'})},onTopWhileDragging:function(b){var b=typeof(b)!="undefined"?b:100000;var c=ToolMan.css().readStyle(this.element,"z-index");this.register('dragstart',function(a){a.group.element.style.zIndex=b});this.register('dragend',function(a){a.group.element.style.zIndex=c})},_dragInit:function(a){a=ToolMan.events().fix(a);var b=document.toolManDragGroup=this.toolManDragGroup;var c=b.factory._createEvent('draginit',a,b);b._isThresholdExceeded=false;b._initialMouseOffset=c.mouseOffset;b._grabOffset=c.mouseOffset.minus(c.topLeftOffset);ToolMan.events().register(document,'mousemove',b._drag);document.onmousemove=function(){return false};ToolMan.events().register(document,'mouseup',b._dragEnd);b._notifyListeners(c)},_drag:function(a){a=ToolMan.events().fix(a);var b=ToolMan.coordinates();var c=this.toolManDragGroup;if(!c)return;var d=c.factory._createEvent('dragmove',a,c);var e=d.mouseOffset.minus(c._grabOffset);if(!c._isThresholdExceeded){var f=d.mouseOffset.distance(c._initialMouseOffset);if(f<c._thresholdDistance)return;c._isThresholdExceeded=true;c._notifyListeners(c.factory._createEvent('dragstart',a,c))}for(i in c._transforms){var g=c._transforms[i];e=g(e,d)}var h=e.minus(d.topLeftOffset);var j=d.topLeftPosition.plus(h);j.reposition(c.element);d.transformedMouseOffset=e.plus(c._grabOffset);c._notifyListeners(d);var k=e.minus(b.topLeftOffset(c.element));if(k.x!=0||k.y!=0){b.topLeftPosition(c.element).plus(k).reposition(c.element)}},_dragEnd:function(a){a=ToolMan.events().fix(a);var b=this.toolManDragGroup;var c=b.factory._createEvent('dragend',a,b);b._notifyListeners(c);this.toolManDragGroup=null;ToolMan.events().unregister(document,'mousemove',b._drag);document.onmousemove=null;ToolMan.events().unregister(document,'mouseup',b._dragEnd)},_notifyListeners:function(a){var b=this._listeners[a.type];for(i in b){b[i](a)}}};function _ToolManDragEvent(a,b,c){this.type=a;this.group=c;this.mousePosition=ToolMan.coordinates().mousePosition(b);this.mouseOffset=ToolMan.coordinates().mouseOffset(b);this.transformedMouseOffset=this.mouseOffset;this.topLeftPosition=ToolMan.coordinates().topLeftPosition(c.element);this.topLeftOffset=ToolMan.coordinates().topLeftOffset(c.element)};_ToolManDragEvent.prototype={toString:function(){return"mouse: "+this.mousePosition+this.mouseOffset+"    "+"xmouse: "+this.transformedMouseOffset+"    "+"left,top: "+this.topLeftPosition+this.topLeftOffset}};ToolMan._dragFactory._constraintFactory={vertical:function(){return function(a,b){var x=b.topLeftOffset.x;return a.x!=x?a.factory.create(x,a.y):a}},horizontal:function(){return function(a,b){var y=b.topLeftOffset.y;return a.y!=y?a.factory.create(a.x,y):a}}};ToolMan._dragsortFactory={makeSortable:function(a){var b=ToolMan.drag().createSimpleGroup(a);b.register('dragstart',this._onDragStart);b.register('dragmove',this._onDragMove);b.register('dragend',this._onDragEnd);return b},makeListSortable:function(f){var g=ToolMan.helpers();var h=ToolMan.coordinates();var j=f.getElementsByTagName("li");g.map(j,function(c){var d=dragsort.makeSortable(c);d.setThreshold(4);var e,max;d.addTransform(function(a,b){return a.constrainTo(e,max)});d.register('dragstart',function(){var a=f.getElementsByTagName("li");e=max=h.topLeftOffset(a[0]);for(var i=1,n=a.length;i<n;i++){var b=h.topLeftOffset(a[i]);e=e.min(b);max=max.max(b)}})});for(var i=1,n=arguments.length;i<n;i++)g.map(j,arguments[i])},_onDragStart:function(a){},_onDragMove:function(a){var b=ToolMan.helpers();var c=ToolMan.coordinates();var d=a.group.element;var e=a.transformedMouseOffset;var f=null;var g=b.previousItem(d,d.nodeName);while(g!=null){var h=c.bottomRightOffset(g);if(e.y<=h.y&&e.x<=h.x){f=g}g=b.previousItem(g,d.nodeName)}if(f!=null){b.moveBefore(d,f);return}var i=b.nextItem(d,d.nodeName);while(i!=null){var j=c.topLeftOffset(i);if(j.y<=e.y&&j.x<=e.x){f=i}i=b.nextItem(i,d.nodeName)}if(f!=null){b.moveBefore(d,b.nextItem(f,d.nodeName));return}},_onDragEnd:function(a){ToolMan.coordinates().create(0,0).reposition(a.group.element)}};var coordinates=ToolMan.coordinates();var dragsort=ToolMan.dragsort();